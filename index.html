<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Move</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }

        #map {
            width: 100%;
            height: 50%;
        }

        #status {
            width: 100%;
            height: 25%;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #stops {
            width: 100%;
            height: 25%;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            box-sizing: border-box;
            overflow-y: auto;
        }

        .stop {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .name {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="status">
        <div id="time-difference"></div>
        <div id="next-stop"></div>
    </div>
    <div id="stops"></div>

    <script>
        // Initialize variables
        let map;
        let currentPosition;
        let currentStop;
        let stops = [];
        let route = null;

        // Initialize the map and GPS
        function initMap() {
            // Replace with your actual map initialization code
            map = L.map('map').setView([0, 0], 13);

            // Request user's location
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(setCurrentPosition, handleLocationError);
            } else {
                handleLocationError(console.error('Geolocation is not supported by this browser.'));
            }

            // Add a marker for the user's current position
            function setCurrentPosition(position) {
                currentPosition = position;
                L.marker([currentPosition.coords.latitude, currentPosition.coords.longitude]).addTo(map);
                calculateTimeDifference();
            }

            // Handle location errors
            function handleLocationError(error) {
                console.error(error);
            }
        }

        // Calculate the time difference between the current time and the scheduled time for the next stop
        function calculateTimeDifference() {
            if (route && currentStop) {
                const now = new Date();
                const scheduledTime = new Date(currentStop.scheduledTime);
                const timeDifference = Math.abs(now - scheduledTime);
                const minutes = Math.floor(timeDifference / 60000);
                const seconds = Math.floor((timeDifference % 60000) / 1000);
                document.getElementById('time-difference').textContent = (timeDifference < 0 ? '-' : '+') + `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        // Add a new stop to the route
        function addStop(name, scheduledTime) {
            const stop = {
                name,
                scheduledTime,
                position: currentPosition
            };
            stops.push(stop);
            updateStops();
        }

        // Update the list of stops
        function updateStops() {
            document.getElementById('stops').innerHTML = '';
            stops.forEach((stop, index) => {
                const stopElement = document.createElement('div');
                stopElement.className = 'stop';
                stopElement.innerHTML = `
                    <span class="name">${stop.name}</span>
                    <span>${new Date(stop.scheduledTime).toLocaleTimeString()}</span>
                `;
                stopElement.addEventListener('click', () => {
                    currentStop = stop;
                    calculateTimeDifference();
                });
                document.getElementById('stops').appendChild(stopElement);
            });
        }

        // Save the current route
        function saveRoute() {
            route = stops;
            stops = [];
            updateStops();
        }

        // Load a saved route
        function loadRoute(route) {
            this.route = route;
            stops = route;
            updateStops();
        }

        // Remove the current route
        function removeRoute() {
            route = null;
            stops = [];
            updateStops();
        }

        // Initialize the application
        initMap();
    </script>
</body>
</html>
